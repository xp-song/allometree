<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Get started with allometree • allometree</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Get started with allometree">
<meta property="og:description" content="allometree">
<meta property="og:image" content="man/figures/logo.png">
<meta property="og:image:alt" content="Allometric Scaling of Urban Trees">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:creator" content="@song_xiaoping">
<meta name="twitter:site" content="https://xp-song.github.io">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-165592310-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-165592310-1');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">allometree</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="Unreleased version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/allometree.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/single-species_models.html">Single-species linear models</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/xp-song/allometree/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Get started with allometree</h1>
            
            <h4 class="date">2020-07-01</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/xp-song/allometree/blob/master/vignettes/allometree.Rmd"><code>vignettes/allometree.Rmd</code></a></small>
      <div class="hidden name"><code>allometree.Rmd</code></div>

    </div>

    
    
<p>The <code>allometree</code> package enables you to develop and use allometric equations relating to the size and structure of urban trees. For example, these equations have been used to predict trunk diameter from tree age, as well as to predict tree height, crown height, crown diameter and leaf area from trunk diameter. They are foundational to other models that estimate the benefits and hazards associated with trees as they mature and grow in size.</p>
<p>This document demonstrates the workflow to develop these allometric models, taking the relationship between two size parameters as an example: Predicting tree <em>height</em> from trunk <em>diameter</em>.</p>
<p>Two linear modelling approaches will be introduced:</p>
<ol style="list-style-type: decimal">
<li>Regression models developed separately for each species, i.e., <em>single-species models</em>
</li>
<li>Mixed-effects model that includes all species as random effects, i.e., <em>mixed-effects model</em>
</li>
</ol>
<div id="example-data-urbantrees" class="section level2">
<h2 class="hasAnchor">
<a href="#example-data-urbantrees" class="anchor"></a>Example data: <code>urbantrees</code>
</h2>
<p>We will be using <code><a href="https://rdrr.io/r/utils/data.html">data(urbantrees)</a></code>. It contains five species planted along streets in Singapore, each spanning a wide range of heights and diameter sizes (in metres).</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="no">urbantrees</span>, <span class="kw">package</span> <span class="kw">=</span> <span class="st">"allometree"</span>)
<span class="no">urbantrees</span>
<span class="co">#&gt; # A tibble: 1,585 x 3</span>
<span class="co">#&gt;    species                  diameter height</span>
<span class="co">#&gt;    &lt;chr&gt;                       &lt;dbl&gt;  &lt;int&gt;</span>
<span class="co">#&gt;  1 Hopea odorata              0.0987      4</span>
<span class="co">#&gt;  2 Hopea odorata              0.108       4</span>
<span class="co">#&gt;  3 Hopea odorata              0.111       4</span>
<span class="co">#&gt;  4 Xanthostemon chrysanthus   0.191       5</span>
<span class="co">#&gt;  5 Xanthostemon chrysanthus   0.150       5</span>
<span class="co">#&gt;  6 Xanthostemon chrysanthus   0.137       5</span>
<span class="co">#&gt;  7 Xanthostemon chrysanthus   0.207       5</span>
<span class="co">#&gt;  8 Xanthostemon chrysanthus   0.162       5</span>
<span class="co">#&gt;  9 Xanthostemon chrysanthus   0.134       5</span>
<span class="co">#&gt; 10 Xanthostemon chrysanthus   0.105       3</span>
<span class="co">#&gt; # … with 1,575 more rows</span>

<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggplot2</span>)

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">urbantrees</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="no">diameter</span>, <span class="no">height</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span>(~ <span class="no">species</span>, <span class="kw">scales</span> <span class="kw">=</span> <span class="st">"free"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>()</pre></body></html></div>
<p><img src="allometree_files/figure-html/load%20data-1.png" width="528" style="display: block; margin: auto;"></p>
</div>
<div id="allometric-equations-eqns_info" class="section level2">
<h2 class="hasAnchor">
<a href="#allometric-equations-eqns_info" class="anchor"></a>Allometric equations: <code>eqns_info</code>
</h2>
<p>Allometric relationships for urban trees can vary drastically from those for forest trees, and are also influenced by human factors such as pruning and fertilisation. Empirical models are developed using six allometric equations used for urban trees (McPherson <em>et al.</em>, 2016).</p>
<p>More information can be found in <code>?eqns_info</code>, as well as in <code><a href="https://rdrr.io/r/utils/data.html">data(eqns_info)</a></code>. The column <code>modelcode</code> shows the unique model code for each equation:</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="no">eqns_info</span>, <span class="kw">package</span> <span class="kw">=</span> <span class="st">"allometree"</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">eqns_info</span>)
<span class="co">#&gt;   modeltype    base_equation   base_formula      weights modelcode</span>
<span class="co">#&gt; 1    Linear       y = a + bx          y ~ x                 lin_w1</span>
<span class="co">#&gt; 2    Linear       y = a + bx          y ~ x I(1/sqrt(x))    lin_w2</span>
<span class="co">#&gt; 3    Linear       y = a + bx          y ~ x       I(1/x)    lin_w3</span>
<span class="co">#&gt; 4    Linear       y = a + bx          y ~ x     I(1/x^2)    lin_w4</span>
<span class="co">#&gt; 5 Quadratic y = a + bx + x^2 y ~ x + I(x^2)                quad_w1</span>
<span class="co">#&gt; 6 Quadratic y = a + bx + x^2 y ~ x + I(x^2) I(1/sqrt(x))   quad_w2</span></pre></body></html></div>
<hr>
</div>
<div id="single-species-models" class="section level2">
<h2 class="hasAnchor">
<a href="#single-species-models" class="anchor"></a>1. Single-species models</h2>
<p>We can run <code>sp_modelselect_multi()</code> to select the best-fit model for each species in the dataset <code>urbantrees</code>. This can also be done for individual species using <code>sp_modelselect()</code>. Note that you can also fit data to specified (i.e. pre-defined) equations, using the functions <code>sp_modelfit()</code> and <code>sp_modelfit_multi()</code>. This can be done, for example, after the removal of outliers from the full dataset. See the vignette <a href="single-species_models.html">Single-species linear models</a> for a full demonstration.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">results</span> <span class="kw">&lt;-</span> <span class="fu">sp_modelselect_multi</span>(<span class="no">urbantrees</span>, <span class="kw">species</span> <span class="kw">=</span> <span class="st">"species"</span>, <span class="co"># specify colname of species</span>
                                <span class="kw">response</span> <span class="kw">=</span> <span class="st">"height"</span>, <span class="kw">predictor</span> <span class="kw">=</span> <span class="st">"diameter"</span>) <span class="co"># specify colnames of variables</span></pre></body></html></div>
<p><code>results</code> is a list of 3 elements:</p>
<ol style="list-style-type: decimal">
<li>List of tables showing each species’ candidate models ranked by AICc value, named <code>sp_models_rank</code>.</li>
<li>List of each species’ best-fit model object, named <code>sp_models</code>.</li>
<li>Table showing each species’ best-fit model information, named <code>sp_models_info</code>.</li>
</ol>
<p> </p>
<p>An overview of the best-fit models across the 5 species:</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">results</span>$<span class="no">sp_models_info</span>
<span class="co">#&gt;                    species modelcode         a           b          c        d</span>
<span class="co">#&gt; 1            Albizia saman    lin_w1  6.717431   9.4640964         NA       NA</span>
<span class="co">#&gt; 2            Hopea odorata  quart_w4 -1.149669 149.3178483 -1522.6122 7908.410</span>
<span class="co">#&gt; 3     Syzygium myrtifolium  quart_w2 -4.614100 158.5128488  -748.2492 1638.676</span>
<span class="co">#&gt; 4       Terminalia mantaly   expo_w1  1.241983   3.8600410         NA       NA</span>
<span class="co">#&gt; 5 Xanthostemon chrysanthus loglog_w1  2.946637   0.5886442         NA       NA</span>
<span class="co">#&gt;            e response_geom_mean correctn_factor predictor_min predictor_max</span>
<span class="co">#&gt; 1         NA          13.566083        1.000000    0.31194369     1.5278875</span>
<span class="co">#&gt; 2 -14225.442           5.390829        1.000000    0.03183099     0.2928451</span>
<span class="co">#&gt; 3  -1321.221           7.735643        1.000000    0.04138029     0.5665916</span>
<span class="co">#&gt; 4         NA           7.596013        1.000533    0.03501409     0.5602254</span>
<span class="co">#&gt; 5         NA           5.067462        1.001099    0.02864789     0.3533240</span>
<span class="co">#&gt;   response_min response_max residual_SE mean_SE adj_R2   n</span>
<span class="co">#&gt; 1            8           20      2.2050  4.7889 0.4276 133</span>
<span class="co">#&gt; 2            2           15     11.9430  2.6339 0.5460 483</span>
<span class="co">#&gt; 3            1           18      2.1674  2.2536 0.6662 353</span>
<span class="co">#&gt; 4            3           18      0.2493  0.0615 0.6702 197</span>
<span class="co">#&gt; 5            2           43      0.2381  0.0564 0.5551 419</span></pre></body></html></div>
<p> </p>
<p>We can simulate data across a range of diameter sizes for each species, and use their respective models to make predictions of tree height. The simulated data can also be extrapolated beyond the range used to fit the model, using the argument <code>extrapolate</code>:</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">predictions</span> <span class="kw">&lt;-</span> <span class="fu">sp_simulate</span>(<span class="kw">ref_table</span> <span class="kw">=</span> <span class="no">results</span>$<span class="no">sp_models_info</span>, <span class="kw">models</span> <span class="kw">=</span> <span class="no">results</span>$<span class="no">sp_models</span>,
                           <span class="kw">extrapolate</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>,<span class="fl">1</span>))
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">predictions</span>)
<span class="co">#&gt; # A tibble: 6 x 6</span>
<span class="co">#&gt; # Groups:   species [1]</span>
<span class="co">#&gt;   species       predictor   fit   lwr   upr extrapolated</span>
<span class="co">#&gt;   &lt;chr&gt;             &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;       </span>
<span class="co">#&gt; 1 Albizia saman     0.312  9.67  5.21  14.1 No          </span>
<span class="co">#&gt; 2 Albizia saman     0.324  9.79  5.33  14.2 No          </span>
<span class="co">#&gt; 3 Albizia saman     0.337  9.90  5.45  14.4 No          </span>
<span class="co">#&gt; 4 Albizia saman     0.349 10.0   5.57  14.5 No          </span>
<span class="co">#&gt; 5 Albizia saman     0.361 10.1   5.69  14.6 No          </span>
<span class="co">#&gt; 6 Albizia saman     0.373 10.3   5.81  14.7 No</span></pre></body></html></div>
<p> </p>
<p><code>predictions</code> is a dataframe of simulated data for the diameter size (<code>predictor</code>) for each <code>species</code>. Other columns include the predicted height (<code>fit</code>), the lower (<code>lwr</code>) and upper (<code>upr</code>) bounds of the prediction interval, as well as whether the height/diameter variables are <code>extrapolated</code> beyond the original data used to fit the model.</p>
<hr>
</div>
<div id="mixed-effects-model" class="section level2">
<h2 class="hasAnchor">
<a href="#mixed-effects-model" class="anchor"></a>2. Mixed-effects model</h2>
<p>In the works…</p>
<hr>
</div>
<div id="comparision-between-model-types" class="section level2">
<h2 class="hasAnchor">
<a href="#comparision-between-model-types" class="anchor"></a>3. Comparision between model types</h2>
<p>In the works…</p>
<hr>
</div>
<div id="references" class="section level2">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<p>McPherson E. G., van Doorn N. S. &amp; Peper P. J. (2016) Urban Tree Database and Allometric Equations. <em>General Technical Report PSW-GTR-253, USDA Forest Service</em>, 86.</p>
<p>Song, X. P., Lai, H. R., Wijedasa, L. S., Tan, P. Y., Edwards, P. J., &amp; Richards, D. R., Height–diameter allometry for the management of city trees in the tropics (in prep).</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://xp-song.github.io">Xiao Ping Song</a>, Hao Ran Lai.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
